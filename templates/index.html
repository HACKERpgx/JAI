<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0c0c0d" />
  <link rel="manifest" href="/manifest.json" />
  <title>JAI Assistant</title>
  <style>
    :root { --bg:#020202; --fg:#c8ffdf; --neon:#39ff14; --dim:#0a0a0a; --grid:#0d1f15; --glass:#041a12; --muted:#8bc9a7; }
    html, body { margin:0; padding:0; height:100%; background:#000; color: var(--fg); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
    body { display:flex; align-items:flex-start; justify-content:center; min-height:100svh; overflow:auto; padding:16px 0; }
    #rain { position: fixed; inset:0; z-index:0; filter: blur(2px) saturate(120%); opacity:0.35; pointer-events:none; }
    .overlay { position: fixed; inset:0; background: radial-gradient(1200px 800px at 50% 60%, rgba(0,255,140,0.06), transparent 60%); z-index:1; pointer-events:none; }
    .terminal { position: relative; z-index:2; width:min(1100px, 92vw); height:min(70vh, 720px); border:1px solid rgba(57,255,20,0.25); border-radius:14px; background: linear-gradient(180deg, rgba(6,20,14,0.7), rgba(2,10,6,0.85)); box-shadow: 0 0 24px rgba(57,255,20,0.15), inset 0 0 24px rgba(57,255,20,0.05); backdrop-filter: blur(6px); display:flex; flex-direction:column; overflow:hidden; }
    .term-head { display:flex; align-items:center; gap:10px; padding:10px 14px; border-bottom:1px solid rgba(57,255,20,0.2); color: var(--fg); letter-spacing:0.5px; text-shadow: 0 0 6px rgba(57,255,20,0.35); }
    .led { width:10px; height:10px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #b6ffd1, #39ff14 40%, #0c3 60%, #062); box-shadow: 0 0 10px #39ff14, 0 0 20px rgba(57,255,20,0.6); }
    .title { font-weight:700; color:#b6ffd1; }
    .log { flex:1; padding:16px; overflow:auto; display:flex; flex-direction:column; gap:6px; scrollbar-width: thin; }
    .line { color:#b6ffd1; text-shadow: 0 0 8px rgba(57,255,20,0.25); white-space: pre-wrap; }
    .line.me { color:#8fffc9; }
    .line.bot { color:#caffea; }
    .prompt { display:flex; align-items:center; gap:10px; padding:14px; border-top:1px solid rgba(57,255,20,0.2); background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.25)); }
    .caret { color:#39ff14; text-shadow:0 0 8px #39ff14; font-weight:700; }
    #txt { flex:1; background: transparent; color:#d9ffe8; border:none; outline:none; font: 16px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; caret-color:#39ff14; }
    #txt::placeholder { color: rgba(165,255,208,0.35); }
    .blink { width:10px; height:20px; background:#39ff14; box-shadow: 0 0 8px #39ff14, 0 0 16px rgba(57,255,20,0.6); animation: blink 1s step-end infinite; }
    .send { background: rgba(57,255,20,0.1); border:1px solid rgba(57,255,20,0.35); color:#caffea; padding:8px 12px; border-radius:8px; font-weight:700; text-shadow:0 0 6px rgba(57,255,20,0.4); }
    .send:hover { background: rgba(57,255,20,0.16); }
    @keyframes blink { 50% { opacity: 0; } }
    @media (max-width: 640px){ .terminal{ height:min(72vh, 640px);} #txt{ font-size:15px;} }
    .stacker{ display:flex; flex-direction:column; gap:16px; align-items:center; position:relative; z-index:2; }
    .attach-row{ display:flex; align-items:center; gap:10px; padding:10px 14px; border-top:1px solid rgba(57,255,20,0.2); background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.25)); }
    .icon-btn{ width:36px; height:36px; border-radius:9999px; border:1px solid rgba(57,255,20,0.35); background: rgba(57,255,20,0.08); color:#b6ffd1; display:grid; place-items:center; transition: background .2s ease, transform .06s ease, color .2s ease, box-shadow .2s ease; }
    .icon-btn:hover{ background: rgba(57,255,20,0.14); color:#d8ffe9; }
    .icon-btn:active{ transform: scale(0.98); }
    .icon-btn:focus-visible{ outline: 3px solid rgba(57,255,20,0.35); outline-offset: 2px; }
  </style>
</head>
<body>
  <canvas id="rain"></canvas>
  <div class="overlay"></div>
  <div class="stacker">
    <div class="terminal">
    <div class="term-head">
      <div class="led"></div>
      <div class="title">JAI WEBSITE</div>
    </div>
    <div id="log" class="log"></div>
    <div class="prompt">
      <span class="caret">&gt;</span>
      <input id="txt" type="text" placeholder="Type a command..." autocomplete="off" spellcheck="false" />
      <span class="blink"></span>
      <button id="send" class="send">Send</button>
    </div>
    <div class="attach-row" role="group" aria-label="Attachments">
      <button id="btnPhoto" class="icon-btn" aria-label="Photos" title="Photos">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="5" width="18" height="14" rx="2"/>
          <circle cx="8.5" cy="9.5" r="1.5"/>
          <path d="M3 16l5-5 4 4 3-3 6 6"/>
        </svg>
      </button>
      <button id="btnVideo" class="icon-btn" aria-label="Videos" title="Videos">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <rect x="3" y="5" width="18" height="14" rx="2"/>
          <path d="M7 5v14M17 5v14"/>
          <path d="M12 10l4 2-4 2z" fill="currentColor" stroke="none"/>
        </svg>
      </button>
      <button id="btnRemove" class="icon-btn" aria-label="Remove files" title="Remove files">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 6h18"/>
          <path d="M8 6V4h8v2"/>
          <rect x="6" y="6" width="12" height="14" rx="2"/>
          <path d="M10 11v6M14 11v6"/>
        </svg>
      </button>
      <button id="btnFile" class="icon-btn" aria-label="Files" title="Files">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M21.44 11.05l-8.49 8.49a5.5 5.5 0 0 1-7.78-7.78l9.19-9.19a3.5 3.5 0 1 1 4.95 4.95l-9.19 9.19a1.5 1.5 0 0 1-2.12-2.12l8.49-8.49"/>
        </svg>
      </button>
      <button id="btnCamera" class="icon-btn" aria-label="Camera" title="Camera">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="8"/>
          <path d="M12 4.5l3 5-3 3-3-5z" fill="currentColor" stroke="none"/>
          <path d="M20 12l-5 3-3-3 5-3z" fill="currentColor" stroke="none"/>
          <path d="M12 19.5l-3-5 3-3 3 5z" fill="currentColor" stroke="none"/>
        </svg>
      </button>
    </div>
    <input id="filePhoto" type="file" accept="image/*" style="display:none" />
    <input id="fileVideo" type="file" accept="video/*" style="display:none" />
    <input id="fileFile" type="file" style="display:none" />
    <input id="fileCamera" type="file" accept="image/*" capture="environment" style="display:none" />
    </div>
  </div>

<script>
  function rid(){ return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16)); }
  const log = document.getElementById('log');
  function push(role, text){
    const div = document.createElement('div');
    div.className = 'line ' + (role === 'me' ? 'me' : 'bot');
    div.textContent = text;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }
  async function sendText(){
    const input = document.getElementById('txt');
    const text = input.value.trim();
    if(!text) return;
    push('me', '> ' + text);
    input.value = '';
    try {
      const res = await fetch('/api/text', {
        method:'POST',
        headers: { 'Content-Type':'application/json', 'X-Request-Id': rid() },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      push('bot', (data && data.response) ? data.response : JSON.stringify(data));
    } catch(e){
      push('bot', 'Network error');
    }
  }
  document.getElementById('send').addEventListener('click', sendText);
  document.getElementById('txt').addEventListener('keydown', e=>{ if(e.key==='Enter') sendText(); });
  window.addEventListener('load', ()=>{ document.getElementById('txt').focus(); });

  const btnPhoto = document.getElementById('btnPhoto');
  const btnVideo = document.getElementById('btnVideo');
  const btnRemove = document.getElementById('btnRemove');
  const btnFile = document.getElementById('btnFile');
  const btnCamera = document.getElementById('btnCamera');
  const inPhoto = document.getElementById('filePhoto');
  const inVideo = document.getElementById('fileVideo');
  const inFile = document.getElementById('fileFile');
  const inCamera = document.getElementById('fileCamera');

  function names(list){ try { return Array.from(list || []).map(f=>f.name).join(', ');} catch(_) { return ''; } }
  function showSelect(kind, list){
    const n = names(list);
    if(n){ push('me', '> ' + kind + ': ' + n); }
  }
  if(btnPhoto) btnPhoto.addEventListener('click', ()=> { if(inPhoto) inPhoto.click(); });
  if(btnVideo) btnVideo.addEventListener('click', ()=> { if(inVideo) inVideo.click(); });
  if(btnRemove) btnRemove.addEventListener('click', ()=> {
    if(inPhoto) inPhoto.value = '';
    if(inVideo) inVideo.value = '';
    if(inFile) inFile.value = '';
    if(inCamera) inCamera.value = '';
    push('me', '> Cleared attachments');
  });
  if(btnFile) btnFile.addEventListener('click', ()=> { if(inFile) inFile.click(); });
  if(btnCamera) btnCamera.addEventListener('click', ()=> { if(inCamera) inCamera.click(); });

  if(inPhoto) inPhoto.addEventListener('change', e => showSelect('Photo', e.target.files));
  if(inVideo) inVideo.addEventListener('change', e => showSelect('Video', e.target.files));
  if(inFile) inFile.addEventListener('change', e => showSelect('File', e.target.files));
  if(inCamera) inCamera.addEventListener('change', e => showSelect('Camera', e.target.files));

  const canvas = document.getElementById('rain');
  const ctx = canvas.getContext('2d');
  let fontSize = 16;
  let columns = 0;
  let drops = [];
  const chars = 'アァカサタナハマヤャラワ0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&*+-<>=?';
  function resize(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    columns = Math.floor(canvas.width / fontSize) + 1;
    drops = Array(columns).fill(0);
  }
  function draw(){
    ctx.fillStyle = 'rgba(0,0,0,0.06)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#39ff14';
    ctx.font = fontSize + 'px monospace';
    for(let i=0;i<drops.length;i++){
      const text = chars.charAt(Math.floor(Math.random()*chars.length));
      const x = i * fontSize;
      const y = drops[i] * fontSize;
      ctx.fillText(text, x, y);
      if(y > canvas.height && Math.random() > 0.975) drops[i] = 0;
      drops[i]++;
    }
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize', resize);
  resize();
  draw();

  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=>{
      navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
    });
  }
</script>
</body>
</html>
